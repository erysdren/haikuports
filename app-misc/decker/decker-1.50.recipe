SUMMARY="A multimedia sketchpad"
DESCRIPTION="Decker is a multimedia platform for creating and sharing interactive \
documents, with sound, images, hypertext, and scripted behavior."
HOMEPAGE="http://beyondloom.com/decker/"
COPYRIGHT="2022-2024 John Earnest"
LICENSE="MIT"
REVISION="1"
SOURCE_URI="https://github.com/JohnEarnest/Decker/archive/refs/tags/v$portVersion.tar.gz"
CHECKSUM_SHA256="8511c20d8ff41c5ab45c3565e9d63cf3de1ebe3fbe8bde71e7e25370c3d4b113"
SOURCE_DIR="Decker-$portVersion"
ADDITIONAL_FILES="Decker.rdef.in"

ARCHITECTURES="all !x86_gcc2"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	decker$secondaryArchSuffix = $portVersion
	app:Decker
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libSDL2_2.0$secondaryArchSuffix
	lib:libSDL2_image_2.0$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libSDL2_2.0$secondaryArchSuffix
	devel:libSDL2_image_2.0$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:gcc$secondaryArchSuffix
	cmd:ld$secondaryArchSuffix
	cmd:xxd
	cmd:make
	"

BUILD()
{
	make $jobArgs -f Makefile decker
}

INSTALL()
{
	local APP_SIGNATURE="application/x-vnd.Decker"
	local MAJOR="`echo "$portVersion" | cut -d. -f1`"
	local MINOR="`echo "$portVersion" | cut -d. -f2`"
	local LONG_INFO="$SUMMARY"
	sed \
		-e "s|@APP_SIGNATURE@|$APP_SIGNATURE|" \
		-e "s|@MAJOR@|$MAJOR|" \
		-e "s|@MINOR@|$MINOR|" \
		-e "s|@LONG_INFO@|$LONG_INFO|" \
		$portDir/additional-files/Decker.rdef.in > Decker.rdef

	addResourcesToBinaries Decker.rdef $sourceDir/c/build/decker
	mimeset -f $sourceDir/c/build/decker

	mkdir -p $appsDir
	cp -a $sourceDir/c/build/decker $appsDir/Decker

	addAppDeskbarSymlink $appsDir/Decker
}
